{{/* content/threads/_content.gotmpl */}}
{{ range $id, $data := .Site.Data.threads }}
  {{ $content := dict 
    "mediaType" "text/markdown"
    "value" (printf "{{< thread %q >}}" $id)
  }}
  
  {{/* Default date fallback - use dates dict as per Hugo docs */}}
  {{ $date := time "2024-01-01T00:00:00Z" }}

  {{/* Extract date from the first message if available */}}
  {{ if gt (len $data.messages) 0 }}
    {{ $firstMsg := index $data.messages 0 }}
    {{ if $firstMsg.timestamp }}
      {{ $date = time $firstMsg.timestamp }}
    {{ end }}
  {{ end }}

  {{/* Use title from data, fallback to generic if not present */}}
  {{ $title := "Untitled Conversation" }}
  {{ if $data.title }}
    {{ $title = $data.title }}
  {{ end }}

  {{ $page := dict
    "kind" "page"
    "path" $id
    "title" $title
    "content" $content
    "dates" (dict "date" $date)
  }}
  {{ $.AddPage $page }}
{{ end }}
